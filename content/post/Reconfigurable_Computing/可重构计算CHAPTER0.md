---
# 常用定义
title: "可重构计算-第0章"           # 标题
date: 2023-02-01    # 创建时间
lastmod: 2023-02-01 # 最后修改时间
draft: false                       # 是否是草稿？
tags: ["可重构计算","CGRA"]  # 标签
categories: ["可重构计算读书笔记"]              # 分类
author: "李尚坤"                  # 作者


# 用户自定义
# 你可以选择 关闭(false) 或者 打开(true) 以下选项
comment: false   # 关闭评论
toc: true       # 关闭文章目录
# 你同样可以自定义文章的版权规则
contentCopyright: '<a rel="license noopener" href="https://creativecommons.org/licenses/by-nc-nd/4.0/" target="_blank">CC BY-NC-ND 4.0</a>'
reward: false	 # 关闭打赏
mathjax: true    # 打开 mathjax
---

# 第0章 绪论

## 0.1 计算与集成电路

### 0.1.1 计算机与冯诺依曼体系

### 0.1.2 集成电路与摩尔定律

* 摩尔定律
* 迪纳德定律
* 目前影响集成电路集成度和性能进一步提升的主要因素：集成工艺，功耗和由此产生的热

## 0.2 计算架构

### 0.2.1 冯-诺伊曼体系架构的变形

​	如果一个系统的运行受到程序的控制，就是广义的处理器；如果不受程序的控制，就是专用处理器

### 0.2.2 通用计算架构

![截屏2023-01-22 20.38.13](/imag/可重构计算/图1.png)

​	控制器在外部时钟的控制下，依据数据通路回送的状态和程序，决定向数据通路发送什么样的控制向量。数据通路根据控制器发来的控制向量决定要进行的运算，运算过程会使用输入的数据并将产生的结果送到系统外输出。
​    1. **专用集成电路架构**：与上面相比，这一架构的最大差别是系统的行为都确定，控制向量确定
​        2. **通用处理器架构**：控制向量根据状态和程序实时产生

## 0.3 数字系统的高层次综合技术

* 高层次综合的目标：将不同工程师写的HDL描述统一到某个优化架构上，从而保证设计的优化程度
* 高层次综合的核心理念：将硬件描述映射到一个优化的架构，从而获得更优的设计

### 0.3.1 基本概念

* 数据从寄存器出发，经过运算再回到寄存器的过程被称为寄存器传输。使用HDL进行的电路设计又称为寄存器传输级设计（Register transfer level），即RTL设计。

* 数据流图DFG与控制流图CFG
* 资源复用的概念

### 0.3.2 数据通路设计

1. **算子调度**：确定每个操作执行的时间位置，以及所需的运算资源的类型和数量。算子调度直接关系到设计电路系统的性能和代价，曾是高层次综合研究的重点。提出了多种算法，可划分为尝试型算法和穷举型算法。力量引导调度算法：算子调度的实质是将各个控制步中同一类运算的数量尽可能平均，以达到运算资源复用最大化，进而减少资源的使用量
2. **资源分配**：为每个操作指定一个具体的运算资源，为每个变量分配一个存储单元，并提供存储单元与资源之间的连接网络
   * 寄存器优化：核心目标是减少寄存器的数量。如果一个寄存器的存活时间与其他一个或多个寄存器的死亡时间重叠，则该寄存器的功能可以被其他寄存器替代
   * 运算资源分配：因为每个算子可能会涉及多个运算资源，因此我们需要对每个算子分配具体的运算资源，不同的分配方案对应的连线网络结构和代价不同。资源分配也产生过多种算法，包括贪婪算法，全通图算法，基于距离的资源分配算法。
   * 连线网络生成：连线网络提供存储单元与运算资源之间的信号通路
     1. 总线架构：优点是灵活性与可扩展性，缺点是延迟时间对系统性能提升不明显
     2. 点对点架构：牺牲灵活性和可扩展性换来更低的整体延迟，在ASIC中被更多地采用
   * 控制码生成与优化：控制码由控制器提供，数据通路按照控制器提供的控制码运行。微码压缩问题
     	1. 控制码生成：首先对多路选择开关控制端进行编码，然后按照控制步一步一步生成
     	2. 控制码优化：减少控制码的量，从而减少所需存储器的容量，降低控制器的复杂度。可以减少码字数量，或者缩短码长。减少码字数量：找出相同的码字；缩短码长：通过全过程中不同端口步之间的关系将端口连接起来

### 0.3.3 控制器设计

控制器是一个FSM

1. 控制器的FSM：状态的定义不同，设计出的FSM不同
2. 基于状态的控制码：将状态码与对应状态关联起来

### 0.3.4 小结

了解了高层次综合方法的脉络：

1. 从硬件的行为设计描述出发
2. 通过算子调度、资源分配、控制码生成等步骤
3. 得到一个运算资源优化的数据通路
4. 确定控制器的架构并完成设计
5. 数据通路和控制器构成系统

## 0.4 可重构计算技术

![图2](/imag/可重构计算/图2.png)

如图所示，将数据通路和控制器设想为完全可编程的，也就是说，从任意一个存储器的输出端出发，经过输入端连接线网络可以到达任意一个ALU的输入端，ALU的结果可以经过输出端网络到达任意一个存储器。这样的ALU网络就是完全可重构的。控制器对应的FSM也是受外部程序控制的，可编程的

FPGA的特点：

1. 它是静态重构，即FPGA的内部结构取决于上电时读取的配置信息，运行过程中不能改变
2. FPGA的LUT（look-up table）不可以被复用
3. FPGA能提供给用户使用的有效逻辑门数量不过50-100万个，而规模却有上千万个逻辑门

通过构建可重构数据通路和可编程控制器，可以有效克服FPGA的缺点，实现运行过程中的实时重构，允许资源复用

### 0.4.1 可重构计算处理器

一个可重构数据通路RCD可以按找软件的要求，变换成与之相适应的硬件网络，并实现其功能，这被称为可重构计算

可重构计算也要求控制器时可编程或可重构的，即可重构控制器RCC，即可编程有限状态机PFSM

控制数据通路的控制码也要求随时生成，因此还需要一个编译器，根据软件生成控制码和控制流程

1. 可重构计算处理器架构

   * RCD与基于PFSM的RCC一起构成了可重构计算处理器(RCP)。![截屏2023-01-24 17.09.43](/imag/可重构计算/图3.png)

     ![截屏2023-01-24 17.09.43](/imag/可重构计算/图4.png)


   * RCD与基于PFSM的RCC一起构成了可重构计算处理器(RCP)

   * 一个软件经过编译器编译，就可以产生配置信息，用于生成PFSM

   * 在多个ALU的系统中，指令系统限制了灵活性。因此RCP不再依赖指令，而是生成软件配置信息，再由RCC通过配置信息对RCD控制

   * 一个理想的RCD应拥有尽可能多的ALU，且这些ALU之间的互连架构可以改变

2. 计算阵列

   * 有一维、二维、三维的ALU阵列架构

3. ALU阵列的计算过程

   * 在RCD中，如果使用一维ALU阵列，则ALU向量可以逐步执行软件。软件的各操作在编译器中实现算子调度、寄存器优化、资源分配，并生成数据通路架构和控制码（配置信息）
   * 一个具备N行ALU的阵列可以并行地支持N个任务 

4. 配置信息

   * 可重构计算中不需要物理上生成数据通路，但是仍然要依据RCD结构，构建一个虚拟的数据通路VD，VD包含RCD中用到的元件
   * 运行给定的软件，还需要由RCC向RCD提供一个FSM，因此，编译器还需要生成一个虚拟FSM

5. PFSM

   * RCC包含状态机和存储器两个部分。状态机包含当前状态，下一个状态以及转移条件

### 0.4.2 可重构计算处理器的编译技术

编译器：将高级编程语言写成的程序/软件翻译成计算机的执行码

1. 可重构计算处理器的编译器架构
   * 可重构计算处理器的编译器将程序/软件翻译成配置信息，包含数据流、控制流和配置信息
   * 高级语言的大部分功能在现有可重构计算处理器的编译器上都支持，但递归调用与指针的实现还在摸索中
2. 代码优化
   * 优化的关键是保证代码的正确性，故对代码的语义分析必须正确。因此针对可重构计算处理器时需要加一些特殊语句来指导编译
3. 任务划分
   * 编译器要根据ALU阵列的大小对程序进行划分，形成一系列的子任务，让可重构计算处理器逐块完成运算
   * 任务划分的一个难点是处理分支，防止死锁
   * 另一个要求是子任务间的通信尽可能减少，也就是不同子任务间的连线数量最小化
4. 任务调度与资源分配
   *  如果可重构计算处理器中包含多个ALU阵列，任务调度就要确定哪些任务可以并行，以便确定要同时运行的ALU阵列数量
   *  然后进行资源分配，当存在多个ALU时，需要确定每个子任务使用的是哪个ALU阵列。这将影响数据传送的代价以及对ALU阵列配置过程产生影响，导致功耗增加
5. 子任务中的算子调度和资源分配
   * 在一定条件下，一个ALU也可以被其他子任务TASK共享，从而提高资源的使用效率
6. VFSM的生成
   * 如果将任务划分产生的一系列子任务TASK作为状态，则可以构建一个以子任务为状态、子任务间依赖关系为边的FSM

### 0.4.3 小结

可重构计算借用了许多高层次综合的概念与方法。

探索可重构计算的原因主要为：

1. 进一步提高计算性能的需求。 通常的冯诺依曼架构采用指令，而执行一条指令的时间中只有很小一部分用于真正计算，所以人们期望改变架构，减少指令执行中准备计算的时间
2. 在提升性能的同时降低功耗，提升计算效能，即提升单位功耗下的性能
3. 经济因素。在22nm之后，随着其他成本，比如研发费用的增加，单个逻辑门的成本下降空间非常有限。这将导致专用集成电路的发展受阻。因此，通过编程或者重构来实现不同功能的通用处理芯片就成为一个必然的选择