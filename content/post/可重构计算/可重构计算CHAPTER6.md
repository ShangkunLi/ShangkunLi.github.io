---
# 常用定义

title: "可重构计算-第6章"           # 标题
date: 2023-02-13    # 创建时间
lastmod: 2023-02-13 # 最后修改时间
draft: false                       # 是否是草稿？
tags: ["可重构计算","CGRA"]  # 标签
categories: ["可重构计算读书笔记"]              # 分类
author: "李尚坤"                  # 作者


# 用户自定义

# 你可以选择 关闭(false) 或者 打开(true) 以下选项

comment: false   # 关闭评论
toc: true       # 关闭文章目录

# 你同样可以自定义文章的版权规则

contentCopyright: '<a rel="license noopener" href="https://creativecommons.org/licenses/by-nc-nd/4.0/" target="_blank">CC BY-NC-ND 4.0</a>'
reward: false	 # 关闭打赏
mathjax: true    # 打开 mathjax
---

# 第6章 计算密集型与控制密集型重构计算

## 6.1 计算密集型与控制密集型应用的特征与举例

- 计算密集型：计算部分所需的执行时间是其总体时间的主要部分
- 数据密集型：IO访问时间和数据搬移时间是其总体时间的主要部分
- 控制密集型：控制流所需的执行时间是其总体执行时间的主要部分

计算密集型和数据密集型适合并行处理。计算密集型将应用划分为多个独立的子任务，并行流水执行；数据密集型将数据分成多个独立的部分。

[**伯克利分类方法**](https://hpac.cs.umu.se/people/springer/cuda_dwarf_seminar.pdf)：十三种典型的分类方法

## 6.2 可重构计算处理器的设计方法

高效处理器系统的两个主流发展方向：

- 并行化设计：增加并行运算单元数目，加速较高并行度的程序段
- 差异化与专用化设计：各个子模块针对专用领域或应用类型进行差异优化

针对计算密集型和控制密集型，对应不同的可重构计算处理器设计：

### 6.2.1 面向计算密集型应用的硬件设计

1. 面向计算密集型应用的可重构控制器的设计

   只含有简单的控制流，配置只需要简单地顺序加载，PFSM也简单，无需特别优化

2. 面向计算密集型应用的可重构数据通路的设计

   包含一个运算单元阵列和运算单元之间的互连

   1. 运算单元阵列的并行化设计
      - 指令级并行：主要体现在运算单元的配置上，多个运算单元组成运算单元阵列
      - 数据级并行：支持矢量化的计算方式
      - 任务级并行：多个协同的运算单元阵列实现，把多个线程分别映射到各个阵列上
   2. 运算单元的功能差异化和专用化设计
      - 不同粒度的运算单元阵列
      - 删除部分运算单元中使用率低的功能，得到基本单元的**异构形式**，能量效率高
   3. 互连结构的并行化设计
      - 过于灵活的互连面积功耗代价较大，降低可重构计算处理器的能效；不灵活的互连会降低阵列内部有效通信的带宽，降低计算性能
   4. 互连结构的功能专用化设计
      - 可以将运算单元的某些类型的算子分离出来，独立成一类专用化的运算单元；例如单目算子延时小，可以加入互连结构，成为专用化的单目运算单元
      - 将阵列的层间通路由具备简单的数据通路，变成一种异构的计算单元，计算分布式设计到互连中

### 6.2.2 面向控制密集型应用的硬件设计

该类应用由大量条件分支和循环结构组成，条件判断的计算量和执行的计算量差不多，控制流和数据通路的通信量较大

- 无条件跳转语句
- 条件分支语句
- 循环语句
- 程序调用语句
- 程序终止语句

消除控制依赖关系，加速互斥和串行的语句是提高控制密集型应用性能的关键

- 减少指令跳转可以提高执行控制密集型应用的性能

1. 可重构数据通路设计

   可将控制流转换为数据流，从而在数据通路上实现控制。比如FPGA的配置不能切换，控制流完全在数据通路上实现

   - 条件执行技术

     将控制依赖转变为数据依赖

     ![](/imag/可重构计算/图12.png)

     加载A和B，但是顺序执行时根据P的结果无效化一条语句

     完全条件执行方式：为每个语句增添条件执行拓展；部分条件执行方式：为某种语句添加条件拓展

     - 完全条件执行的设计方法

       if_conversion算法，把所有条件分支内部的指令替换为条件执行语句

     - 部分条件执行的设计方法

       只增加一个条件数据转移指令或者选择指令

   - 推测执行技术

     强制对分支结构内部的语句使用无条件执行的方式，虽然这些语句有可能不需要执行，但是该技术假定他们需要执行，以消除他们与条件语句的依赖关系

2. 可重构控制器设计

   - 通用处理器

     通用可重构计算处理器拥有足够的灵活性，但效率和性能不高。基于指令的FSM是串行的，对于多分支或嵌套分支结构，指令流会以串行的方式执行条件判断

   - 专用集成电路

     PFSM的ASIC设计：基于LUT（look-up table）

## 6.3 计算密集型任务和控制密集型任务的映射方法

### 6.3.1 计算密集型任务相关的映射方法

1. 问题抽象

   DFG进行映射时的情形：

   - 不足区域：计算区域过小
   - 线性区域：将完成划分的算子区域直接映射到硬件阵列上
   - 冗余区域：较大的算子区域配置部分的计算任务
   - 理想区域：输入输出少，计算量大

2. 映射方案

   - 区域增长：对于不足区域，改变循环，扩展计算区域
   - 矢量化：对于线性区域
   - 虚拟化：对应冗余区域

### 6.3.2 控制密集型任务相关的映射方法